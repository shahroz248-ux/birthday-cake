<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday Michelle</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: #fff0f5;
      font-family: Arial, sans-serif;
    }
    h1 {
      font-size: 2.5em;
      color: #d94b6a;
      margin-bottom: 20px;
    }
    svg {
      width: 600px;
      height: 400px;
    }
    .flame {
      transition: opacity 0.6s ease;
    }
    .extinguished .flame {
      opacity: 0;
    }
  </style>
</head>
<body>
  <h1>Happy Birthday Michelle ❤️</h1>
  <svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg" id="cakeSVG">
    <!-- Cake layers -->
    <ellipse cx="300" cy="370" rx="220" ry="30" fill="#d88b8b"/>
    <rect x="120" y="270" width="360" height="120" rx="40" fill="#f8bfc6" stroke="#d97b7b" stroke-width="4"/>
    <rect x="140" y="220" width="320" height="80" rx="35" fill="#f4a6b0" stroke="#d97b7b" stroke-width="4"/>
    <rect x="160" y="180" width="280" height="50" rx="30" fill="#f9c0c9" stroke="#d97b7b" stroke-width="4"/>

    <!-- Centered frosting -->
    <path d="M180 180 Q240 220 300 180 Q360 220 420 180 L400 160 L200 160 Z" fill="#fff0f5" stroke="#e0a0b0" stroke-width="3"/>

    <!-- Cream drops -->
    <g>
      <circle cx="220" cy="195" r="8" fill="white" stroke="#ddd"/>
      <circle cx="280" cy="190" r="8" fill="white" stroke="#ddd"/>
      <circle cx="340" cy="185" r="8" fill="white" stroke="#ddd"/>
      <circle cx="400" cy="190" r="8" fill="white" stroke="#ddd"/>
    </g>

    <!-- Strawberries -->
    <g>
      <path d="M220 180 C215 170 225 160 220 150 C230 150 240 170 235 180 Z" fill="#e63946" stroke="#b03050" stroke-width="2"/>
      <path d="M300 170 C295 160 305 150 300 140 C310 140 320 160 315 170 Z" fill="#e63946" stroke="#b03050" stroke-width="2"/>
      <path d="M380 180 C375 170 385 160 380 150 C390 150 400 170 395 180 Z" fill="#e63946" stroke="#b03050" stroke-width="2"/>
    </g>

    <!-- Number 23 as candle flames with slight spacing -->
    <g id="number23"></g>
  </svg>

<script>
const svg = document.getElementById("cakeSVG");
const number23Group = document.getElementById("number23");

function createNumberFlame(x, y, char) {
  const ns = "http://www.w3.org/2000/svg";
  const g = document.createElementNS(ns, "g");

  const text = document.createElementNS(ns, "text");
  text.setAttribute("x", x);
  text.setAttribute("y", y);
  text.setAttribute("font-size", 60);
  text.setAttribute("font-weight", "bold");
  text.setAttribute("fill", "#fff");
  text.setAttribute("stroke", "#d94b6a");
  text.setAttribute("stroke-width", 2);
  text.setAttribute("text-anchor", "middle");
  text.textContent = char;
  g.appendChild(text);

  const flame = document.createElementNS(ns, "ellipse");
  flame.setAttribute("cx", x);
  flame.setAttribute("cy", y - 60);
  flame.setAttribute("rx", 8);
  flame.setAttribute("ry", 12);
  flame.setAttribute("fill", "orange");
  flame.setAttribute("class", "flame");
  g.appendChild(flame);

  const glow = document.createElementNS(ns, "circle");
  glow.setAttribute("cx", x);
  glow.setAttribute("cy", y - 60);
  glow.setAttribute("r", 14);
  glow.setAttribute("fill", "gold");
  glow.setAttribute("opacity", "0.4");
  glow.setAttribute("class", "flame");
  g.appendChild(glow);

  return g;
}

// Numbers slightly spaced on top of cake
number23Group.appendChild(createNumberFlame(285, 190, '2'));
number23Group.appendChild(createNumberFlame(315, 190, '3'));

let audioCtx, analyser, source, dataArray;
let isExtinguished = false;

async function enableMic() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    source = audioCtx.createMediaStreamSource(stream);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 1024;
    source.connect(analyser);
    dataArray = new Uint8Array(analyser.fftSize);
    monitor();
  } catch (e) {
    console.error("Mic error", e);
  }
}

function getVolume(arr) {
  let sum = 0;
  for (let i = 0; i < arr.length; i++) {
    const v = (arr[i] - 128) / 128;
    sum += v * v;
  }
  return Math.sqrt(sum / arr.length);
}

function monitor() {
  analyser.getByteTimeDomainData(dataArray);
  const vol = getVolume(dataArray);
  if (!isExtinguished && vol > 0.1) {
    extinguishFlames();
    isExtinguished = true;
  }
  requestAnimationFrame(monitor);
}

function extinguishFlames() {
  svg.classList.add("extinguished");
}

enableMic();
</script>
</body>
</html>
